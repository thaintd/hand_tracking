<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Virtual Nail Art</title>
    <style>
      canvas {
        width: 640px;
        height: 480px;
      }
    </style>
  </head>
  <body>
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas"></canvas>
    <script>
      const video = document.getElementById("video");
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const ws = new WebSocket("ws://localhost:8000/ws");

      // Tùy chọn độ phân giải video
      const constraints = {
        video: {
          width: { ideal: 640 },
          height: { ideal: 480 }
        }
      };

      navigator.mediaDevices.getUserMedia(constraints).then((stream) => {
        video.srcObject = stream;
        video.play();

        ws.onmessage = (event) => {
          const img = new Image();
          img.src = `data:image/jpeg;base64,${event.data}`;
          img.onload = () => {
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
          };
        };

        setInterval(() => {
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
          const frame = canvas.toDataURL("image/jpeg").split(",")[1];
          ws.send(frame);
        }, 200); // Gửi khung hình mỗi 200ms (~5 FPS)
      });
    </script>
  </body>
</html>
